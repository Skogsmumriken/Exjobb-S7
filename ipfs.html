<html>
  <head>
    <!-- Moralis SDK code -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <h1>IPFS demo</h1>

    <!--<button id="btn-login">Login</button><br><br>-->
    <input type="text" name="metaDataName" id="metaDataName" placeholder="name"><br>
    <textarea name="metaDataDescription" id="metaDataDescription" cols="30" rows="10"></textarea>
    <input type="file" name="fileInput" id="fileInput"><br><br>
    <button onclick=gogogo()>Gogogo</button>

    <script>
        
        const serverUrl = "https://3annjbia1vgr.usemoralis.com:2053/server";
        const appId = "aBJvVjmxBnIis9vINNfTCr4qv010ZHKtBGmdX5sq";
        Moralis.start({ serverUrl, appId });

        // add from here down
        /*async function login() {
        let user = Moralis.User.current();
        if (!user) {
            user = await Moralis.authenticate();
        }
        console.log("logged in user:", user);
        } */

        upLoadImage = async () => {
            const data = fileInput.files[0]
            const file = new Moralis.File(data.name, data)
            await file.saveIPFS();
            console.log(file.ipfs(), file.hash());
            return file.ipfs()
        }

        uploadMetadata = async (imageURL) => {
            const name = document.getElementById('metaDataName').value;
            const description = document.getElementById('metaDataDescription').value;

            const metadata = {
                "name": name,
                "descirption": description,
                "image": imageURL
            }

            const file = new Moralis.File("file.json", {base64 : btoa(JSON.stringify(metadata))});
            await file.saveIPFS();


            console.log(file.ipfs());
            }

            gogogo = async () => {
                const image = await upLoadImage();
                await uploadMetadata(image)
            }
        
        </script>
    </body>
</html>